# Проект: Создание приложения для книжной полки

### Прежде чем начать

### Необходимые условия

- Умение создавать и запускать проект в Android Studio.
- Умение создавать макеты в Jetpack Compose.
- Опыт использования корутинов в Kotlin.
- Опыт работы с Retrofit, Coil и Gson.

### Что вы будете создавать

- Приложение для Android, которое выполняет несколько запросов к веб-сервису и отображает асинхронно загруженные изображения.

### Что вам понадобится

- Компьютер с установленной Android Studio.


### Обзор

Чтобы отработать концепции, изученные в этом разделе, включая корутины, Retrofit и Gson, вам предстоит самостоятельно создать приложение, которое выводит список книг с изображениями из Google Books API.

Приложение должно выполнять следующие действия:

- Выполнить запрос к Google Books API с помощью Retrofit.
- Разбор ответа с помощью Gson.
- Отображать асинхронно загруженные изображения книг вместе с их названиями в вертикальной сетке.
- Внедрите лучшие практики, разделяющие пользовательский интерфейс и слой данных, с помощью репозитория.
- Написать тесты для кода, требующего сетевой сервис, используя инъекцию зависимостей.

Цель этого проекта двоякая. Во-первых, вы сможете применить на практике все концепции, изученные в этом разделе. Вы также получите возможность поработать с совершенно новым REST API, почитать документацию и применить полученные навыки в новом приложении, как это делает профессиональный Android-разработчик.

На следующем скриншоте показан пример готового приложения Bookshelf. Точный макет и книги, отображаемые в приложении, вы выбираете сами. Подробнее о том, как получить данные о книгах, вы узнаете из следующих разделов.

<img src="https://developer.android.com/static/codelabs/basic-android-kotlin-compose-bookshelf/img/9335665e21b79da1_856.png" width="300">


### Планирование приложения

Планирование пользовательского интерфейса
Вы можете разрабатывать пользовательский интерфейс своего приложения как угодно. Вам нужно подумать о том, как макет вашего приложения адаптируется к различным форм-факторам устройств.

Поскольку вы используете прокручивающуюся сетку изображений, вам нужно одновременно загружать несколько изображений на экран. Получив URL-адрес изображения, вы можете использовать композит AsyncImage, предоставляемый библиотекой Coil, для загрузки данных в фоновом режиме. По возможности обязательно указывайте пользователям, когда ваше приложение использует сеть.

Планирование сетевого уровня
На первом этапе этого раздела вы узнали, как получать данные из сети и разбирать ответы в формате JSON. Для приложения «Книжная полка» уровень данных должен выполнять следующие три задачи:

Создать сервис Retrofit для получения данных из Google Books API.
Добавить методы сервиса для получения списка книг и информации о конкретной книге.
Использовать Gson для извлечения значимых данных из JSON-ответа, возвращаемого API.
Давайте вкратце рассмотрим методы Google Books API, которые понадобятся вам в этом проекте.

Поиск книг
Google Books API предоставляет метод, который возвращает список книг на основе определенного поискового запроса, как описано в разделе Использование API.

Например, этот URL-адрес возвращает результаты поиска по термину «история джаза».


Пример

```
https://www.googleapis.com/books/v1/volumes?q=jazz+история
```

Существует несколько параметров запроса для фильтрации поиска. Для приложения «Книжная полка» достаточно параметра q (сокращение от query).

В документации также показан ожидаемый ответ в формате JSON. Для приложения Bookshelf необходимо извлечь id книги.

Запрос информации о конкретной книге
Вам нужно сделать запрос, чтобы получить информацию о конкретной книге. Эта конечная точка принимает id, который вы извлекли из предыдущего ответа.

```
https://www.googleapis.com/books/v1/volumes/<volume_id>
```

Ссылки на миниатюры можно найти в объекте imageLinks в объекте volumeInfo. В данном приложении изображения, которые вы хотите загрузить, находятся под ключом thumbnail.


```kt
...
    "imageLinks": {
      "smallThumbnail": "http://books.google.com/books/publisher/content?id=EPUTEAAAQBAJ&printsec=frontcover&img=1&zoom=5&edge=curl&imgtk=AFLRE734s3CngIs16gM_Ht6GeGF4ew664I7oOGghmfk4pgfFcDYb4GlYCYdjtqqXluL2KUyfq_Ni5MSyv4JxEJ8W679zQ2Ib3okUKau3I1ruqBGrWOt2_haUauWC8sXEgjN7JHm4uOjS&source=gbs_api",
      "thumbnail": "http://books.google.com/books/publisher/content?id=EPUTEAAAQBAJ&printsec=frontcover&img=1&zoom=1&edge=curl&imgtk=AFLRE71N0ldzv6rliUV_K5ZACa9yPNcT8Ino6YKXJUMje_z4GsC9cp6gFql5TxlmqMoYN3CDhM3XAIO2riFeMXUnFVr5pTLq91htTtG1DDyvOdiR4yI6xu3yEEAn0dRbvNFZ5m7dUC9E&source=gbs_api",
      "small": "http://books.google.com/books/publisher/content?id=EPUTEAAAQBAJ&printsec=frontcover&img=1&zoom=2&edge=curl&imgtk=AFLRE71HmTwpoe3KR0AISYk5sDgV2Fz-F-6CDKJtFdvlXSZv3jEzFtsSXGJnEGjtCuoDMxP_6sgP8au1yadB7OmI2MhIBquel7ivcDB8e9ieLyh4HNoXnX3zmxfF_CfIfnNXDv0WHuyA&source=gbs_api",
      "medium": "http://books.google.com/books/publisher/content?id=EPUTEAAAQBAJ&printsec=frontcover&img=1&zoom=3&edge=curl&imgtk=AFLRE72LMPH7Q2S49aPeQ3Gm8jLEf6zH4ijuE0nvbOyXBUAgyL816pXzaw0136Pk8jXpfYYFY0IsqL7G7MMDMgKcJhnaoHojWNZpljZmGHeWLL_M7hxkOpmdmO7xza8dfVfPbFmBH4kl&source=gbs_api",
      "large": "http://books.google.com/books/publisher/content?id=EPUTEAAAQBAJ&printsec=frontcover&img=1&zoom=4&edge=curl&imgtk=AFLRE71w0J9EOzUzu1O5GMbwhnpI8BLWzOEtzqc9IfyxEDqimZ--H4JlNAZh_1zx8pqPNRf1qDt7FPb57lH5ip-LBlK3zjMC-MCBYcciuoPjTJOFmLv7pp5B6_-UFBap1KRfC0eG7P4d&source=gbs_api",
      "extraLarge": "http://books.google.com/books/publisher/content?id=EPUTEAAAQBAJ&printsec=frontcover&img=1&zoom=6&edge=curl&imgtk=AFLRE73t0gcxT-jzEETp8Yo5Osr15nVL7ntKL2WSe2S8kRSio7w0CGgErAq4WbPWIsH4TmOdP_EO6ZoPNSP-YGSOwqfPMw8_IlYE6hy9IKeAs5V_xaHy7drZleF0eizAQiEVg5ci7qby&source=gbs_api"
    },
...
```

> Совет: Поскольку для получения URL-адресов изображений необходимо выполнить два набора запросов, получение списка изображений книг является более сложной задачей, чем в приложении Mars photos.
Следующий подход может помочь вам в реализации этого приложения:
Выполните первый запрос для поиска книг.
Выполняйте запросы на получение отдельных данных о книгах один за другим в одной и той же корутине. Таким образом, каждый запрос будет выполняться последовательно, пока не завершится работа корутины. После завершения всех запросов сохраните каждую миниатюру в MutableList.
Загрузите все миниатюры в композиты AsyncImage.

Загрузка миниатюр книг
После того как у вас есть URL-адрес миниатюры, его можно передать композитному AsyncImage в каждом элементе сетки.

> Внимание: Чтобы изображения отображались, необходимо заменить http на https в URL-адресах. Это можно сделать с помощью метода String.replace().

Проектирование для тестирования
В дополнение к сетевым концепциям вы также узнали, как рефакторить приложение, чтобы использовать класс репозитория для уровня данных. Для этого приложения вам следует разрабатывать дизайн с учетом возможности тестирования, используя репозиторий, чтобы легко менять источники данных с помощью инъекции зависимостей.

Включите интерфейс репозитория для службы книг.
Реализуйте класс репозитория, который обращается к сервису Retrofit.
Реализуйте фальшивый сервис, который не делает реальных запросов к API Google Books.
Напишите тест для репозитория с использованием поддельного сервиса.
Данные о книгах должны быть получены из сети с помощью репозитория, что позволит вам легко менять источники данных с помощью инъекции зависимостей.

### Создайте приложение «Книжная полка

Теперь, когда у вас есть общее представление об API Google Books, пришло время создать API Bookshelf. Несмотря на то, что вы используете другой веб-сервис, вы уже изучили все концепции, необходимые для завершения этого проекта. Вы всегда можете обратиться к предыдущим кодебам и примерам приложений из этого раздела, если вам нужно что-то уточнить. Кодовые примеры из этого раздела могут быть полезны вам в процессе работы над проектом.

Мы настоятельно рекомендуем выполнить все проекты курса. Даже если вы чувствуете себя уверенно во всем, что узнали в этом разделе, есть вероятность, что вам придется обращаться к кодовым таблицам чаще, чем вы думаете. Это случается со всеми - даже с преподавателями этого курса! Так что получайте удовольствие от этого проекта и отрабатывайте полученные знания, прежде чем переходить к следующему разделу.
